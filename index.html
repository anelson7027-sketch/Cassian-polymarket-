<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket Opportunity Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-blue: #58a6ff;
            --accent-yellow: #d29922;
            --accent-purple: #a371f7;
            --border: #30363d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: var(--text-secondary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card.green .value { color: var(--accent-green); }
        .stat-card.blue .value { color: var(--accent-blue); }
        .stat-card.yellow .value { color: var(--accent-yellow); }
        .stat-card.purple .value { color: var(--accent-purple); }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        select, input, button {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        button {
            cursor: pointer;
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            font-weight: 600;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .panel-header {
            background: var(--bg-tertiary);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h2 {
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-content {
            padding: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        .opportunity-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: border-color 0.2s;
        }

        .opportunity-card:hover {
            border-color: var(--accent-blue);
        }

        .opportunity-card:last-child {
            margin-bottom: 0;
        }

        .opportunity-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .opportunity-title {
            font-weight: 600;
            font-size: 0.95rem;
            flex: 1;
            padding-right: 15px;
        }

        .opportunity-score {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            white-space: nowrap;
        }

        .score-high {
            background: rgba(63, 185, 80, 0.2);
            color: var(--accent-green);
        }

        .score-medium {
            background: rgba(210, 153, 34, 0.2);
            color: var(--accent-yellow);
        }

        .score-low {
            background: rgba(139, 148, 158, 0.2);
            color: var(--text-secondary);
        }

        .opportunity-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .detail-item {
            text-align: center;
            padding: 8px;
            background: var(--bg-secondary);
            border-radius: 6px;
        }

        .detail-value {
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 2px;
        }

        .detail-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .opportunity-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-right: 5px;
        }

        .tag-arbitrage {
            background: rgba(163, 113, 247, 0.2);
            color: var(--accent-purple);
        }

        .tag-value {
            background: rgba(63, 185, 80, 0.2);
            color: var(--accent-green);
        }

        .tag-momentum {
            background: rgba(88, 166, 255, 0.2);
            color: var(--accent-blue);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: var(--text-secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .method-explanation {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .method-explanation h3 {
            margin-bottom: 15px;
            color: var(--accent-blue);
        }

        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .method-item {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 8px;
        }

        .method-item h4 {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .method-item p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .refresh-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ Polymarket Opportunity Scanner</h1>
        <p>Identifying potentially profitable prediction market positions through quantitative analysis</p>
    </div>

    <div class="stats-grid" id="stats-grid">
        <div class="stat-card blue">
            <div class="value" id="total-markets">-</div>
            <div class="label">Active Markets</div>
        </div>
        <div class="stat-card green">
            <div class="value" id="opportunities-found">-</div>
            <div class="label">Opportunities Found</div>
        </div>
        <div class="stat-card yellow">
            <div class="value" id="avg-edge">-</div>
            <div class="label">Avg Expected Edge</div>
        </div>
        <div class="stat-card purple">
            <div class="value" id="total-volume">-</div>
            <div class="label">Total Volume (24h)</div>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>Min Liquidity:</label>
            <select id="min-liquidity">
                <option value="1000">$1,000+</option>
                <option value="10000" selected>$10,000+</option>
                <option value="50000">$50,000+</option>
                <option value="100000">$100,000+</option>
            </select>
        </div>
        <div class="control-group">
            <label>Strategy:</label>
            <select id="strategy-filter">
                <option value="all">All Strategies</option>
                <option value="value">Value Bets</option>
                <option value="arbitrage">Arbitrage</option>
                <option value="momentum">Momentum</option>
            </select>
        </div>
        <div class="control-group">
            <label>Category:</label>
            <select id="category-filter">
                <option value="all">All Categories</option>
                <option value="politics">Politics</option>
                <option value="crypto">Crypto</option>
                <option value="sports">Sports</option>
                <option value="entertainment">Entertainment</option>
            </select>
        </div>
        <button id="refresh-btn" onclick="loadData()">üîÑ Refresh Data</button>
        <span class="refresh-time" id="last-refresh">Last refresh: Never</span>
    </div>

    <div class="method-explanation">
        <h3>üìä How Opportunities Are Scored</h3>
        <div class="method-grid">
            <div class="method-item">
                <h4><span class="tag tag-value">VALUE</span> Expected Value Analysis</h4>
                <p>Compares market prices to estimated "true" probabilities derived from volume-weighted averages, identifying when markets may be mispriced.</p>
            </div>
            <div class="method-item">
                <h4><span class="tag tag-arbitrage">ARB</span> Cross-Market Arbitrage</h4>
                <p>Detects when YES + NO prices don't sum to ~100%, or when correlated markets have pricing inconsistencies.</p>
            </div>
            <div class="method-item">
                <h4><span class="tag tag-momentum">MOM</span> Smart Money Momentum</h4>
                <p>Tracks large trades and volume spikes that may indicate informed trading activity not yet reflected in price.</p>
            </div>
        </div>
    </div>

    <div class="main-grid">
        <div class="panel">
            <div class="panel-header">
                <h2>üî• Top Opportunities</h2>
                <span id="opp-count">0 found</span>
            </div>
            <div class="panel-content" id="opportunities-list">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Analyzing markets...</span>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <h2>üìà Volume Distribution</h2>
            </div>
            <div class="panel-content">
                <div class="chart-container">
                    <canvas id="volume-chart"></canvas>
                </div>
            </div>
        </div>

        <div class="panel full-width">
            <div class="panel-header">
                <h2>üé≤ Risk/Reward Analysis</h2>
            </div>
            <div class="panel-content">
                <div class="chart-container">
                    <canvas id="scatter-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="panel">
        <div class="panel-header">
            <h2>üìã All Analyzed Markets</h2>
        </div>
        <div class="panel-content" id="all-markets" style="max-height: 600px;">
            <div class="loading">
                <div class="spinner"></div>
                <span>Loading markets...</span>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const GAMMA_API = 'https://gamma-api.polymarket.com';
        const CLOB_API = 'https://clob.polymarket.com';
        
        let allMarkets = [];
        let opportunities = [];
        let volumeChart = null;
        let scatterChart = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            // Auto-refresh every 5 minutes
            setInterval(loadData, 300000);
        });

        async function loadData() {
            const btn = document.getElementById('refresh-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Loading...';

            try {
                await fetchMarkets();
                analyzeOpportunities();
                renderOpportunities();
                renderAllMarkets();
                updateStats();
                updateCharts();
                
                document.getElementById('last-refresh').textContent = 
                    `Last refresh: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('opportunities-list').innerHTML = 
                    `<div class="error">Failed to load data: ${error.message}<br><br>
                    <small>Note: Polymarket API may have CORS restrictions. Try using a browser extension or running through a proxy.</small></div>`;
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîÑ Refresh Data';
            }
        }

        async function fetchMarkets() {
            // Fetch active markets from Polymarket Gamma API
            const response = await fetch(`${GAMMA_API}/markets?closed=false&limit=200`);
            
            if (!response.ok) {
                throw new Error(`API returned ${response.status}`);
            }
            
            const data = await response.json();
            allMarkets = data.filter(m => m.active && !m.closed);
            
            // Enrich with additional data
            allMarkets = allMarkets.map(market => ({
                ...market,
                yesPrice: parseFloat(market.outcomePrices?.[0] || market.bestBid || 0.5),
                noPrice: parseFloat(market.outcomePrices?.[1] || (1 - (market.bestBid || 0.5))),
                volume24h: parseFloat(market.volume24hr || 0),
                totalVolume: parseFloat(market.volume || 0),
                liquidity: parseFloat(market.liquidityNum || market.liquidity || 0),
                spread: calculateSpread(market),
                category: categorizeMarket(market),
                endDate: market.endDate ? new Date(market.endDate) : null
            }));
        }

        function calculateSpread(market) {
            const bid = parseFloat(market.bestBid || 0);
            const ask = parseFloat(market.bestAsk || 0);
            if (bid && ask) {
                return ((ask - bid) / ask * 100).toFixed(2);
            }
            return 5; // Default spread estimate
        }

        function categorizeMarket(market) {
            const title = (market.question || market.title || '').toLowerCase();
            const tags = (market.tags || []).map(t => t.toLowerCase());
            
            if (tags.includes('politics') || title.includes('trump') || title.includes('biden') || 
                title.includes('election') || title.includes('president') || title.includes('congress')) {
                return 'politics';
            }
            if (tags.includes('crypto') || title.includes('bitcoin') || title.includes('ethereum') || 
                title.includes('btc') || title.includes('eth') || title.includes('crypto')) {
                return 'crypto';
            }
            if (tags.includes('sports') || title.includes('nfl') || title.includes('nba') || 
                title.includes('super bowl') || title.includes('championship')) {
                return 'sports';
            }
            if (tags.includes('entertainment') || title.includes('oscar') || title.includes('grammy') || 
                title.includes('movie') || title.includes('album')) {
                return 'entertainment';
            }
            return 'other';
        }

        function analyzeOpportunities() {
            const minLiquidity = parseInt(document.getElementById('min-liquidity').value);
            
            opportunities = allMarkets
                .filter(m => m.liquidity >= minLiquidity)
                .map(market => {
                    const analysis = analyzeMarket(market);
                    return {
                        ...market,
                        ...analysis
                    };
                })
                .filter(m => m.score > 0)
                .sort((a, b) => b.score - a.score);
        }

        function analyzeMarket(market) {
            let score = 0;
            let signals = [];
            let expectedEdge = 0;
            
            // 1. Arbitrage Detection - YES + NO should sum to ~1
            const priceSum = market.yesPrice + market.noPrice;
            if (priceSum < 0.97 || priceSum > 1.03) {
                const arbEdge = Math.abs(1 - priceSum) * 100;
                score += arbEdge * 10;
                signals.push('arbitrage');
                expectedEdge += arbEdge;
            }
            
            // 2. Value Bet Detection - Wide spreads with high volume
            if (market.spread > 3 && market.volume24h > 10000) {
                score += (market.spread / 2) * 5;
                signals.push('value');
                expectedEdge += market.spread / 4;
            }
            
            // 3. Momentum Detection - High recent volume relative to liquidity
            const volumeToLiquidity = market.volume24h / (market.liquidity || 1);
            if (volumeToLiquidity > 0.5) {
                score += volumeToLiquidity * 20;
                signals.push('momentum');
            }
            
            // 4. Mispricing Detection - Extreme prices with high volume
            if ((market.yesPrice < 0.1 || market.yesPrice > 0.9) && market.volume24h > 50000) {
                // Extreme prices on high-volume markets may indicate value
                const extremity = Math.min(market.yesPrice, 1 - market.yesPrice);
                score += (0.1 - extremity) * 100;
                signals.push('value');
                expectedEdge += (0.1 - extremity) * 50;
            }
            
            // 5. Time Value - Markets ending soon may have resolution edge
            if (market.endDate) {
                const daysToExpiry = (market.endDate - new Date()) / (1000 * 60 * 60 * 24);
                if (daysToExpiry > 0 && daysToExpiry < 7) {
                    score += (7 - daysToExpiry) * 3;
                }
            }
            
            // Penalize low liquidity
            if (market.liquidity < 50000) {
                score *= 0.5;
            }
            
            return {
                score: Math.round(score),
                signals: [...new Set(signals)],
                expectedEdge: expectedEdge.toFixed(2),
                recommendation: getRecommendation(market, signals)
            };
        }

        function getRecommendation(market, signals) {
            if (signals.includes('arbitrage')) {
                return `Potential ${((1 - (market.yesPrice + market.noPrice)) * 100).toFixed(1)}% arbitrage spread`;
            }
            if (market.yesPrice < 0.2) {
                return `Low-probability YES at ${(market.yesPrice * 100).toFixed(1)}¬¢ - high asymmetric upside`;
            }
            if (market.yesPrice > 0.8) {
                return `High-probability YES at ${(market.yesPrice * 100).toFixed(1)}¬¢ - consider NO for value`;
            }
            if (signals.includes('momentum')) {
                return `High volume activity - smart money may be moving`;
            }
            return `Expected edge: ~${market.expectedEdge}%`;
        }

        function renderOpportunities() {
            const container = document.getElementById('opportunities-list');
            const strategyFilter = document.getElementById('strategy-filter').value;
            const categoryFilter = document.getElementById('category-filter').value;
            
            let filtered = opportunities;
            
            if (strategyFilter !== 'all') {
                filtered = filtered.filter(o => o.signals.includes(strategyFilter));
            }
            if (categoryFilter !== 'all') {
                filtered = filtered.filter(o => o.category === categoryFilter);
            }
            
            document.getElementById('opp-count').textContent = `${filtered.length} found`;
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state">No opportunities match your filters. Try adjusting the criteria.</div>';
                return;
            }
            
            container.innerHTML = filtered.slice(0, 20).map(opp => `
                <div class="opportunity-card">
                    <div class="opportunity-header">
                        <div class="opportunity-title">
                            <a href="https://polymarket.com/event/${opp.slug || opp.id}" target="_blank">
                                ${opp.question || opp.title}
                            </a>
                        </div>
                        <span class="opportunity-score ${getScoreClass(opp.score)}">
                            Score: ${opp.score}
                        </span>
                    </div>
                    <div class="opportunity-details">
                        <div class="detail-item">
                            <div class="detail-value" style="color: var(--accent-green)">${(opp.yesPrice * 100).toFixed(1)}¬¢</div>
                            <div class="detail-label">YES Price</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value" style="color: var(--accent-red)">${(opp.noPrice * 100).toFixed(1)}¬¢</div>
                            <div class="detail-label">NO Price</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value">${formatCurrency(opp.liquidity)}</div>
                            <div class="detail-label">Liquidity</div>
                        </div>
                    </div>
                    <div class="opportunity-meta">
                        <div>
                            ${opp.signals.map(s => `<span class="tag tag-${s}">${s.toUpperCase()}</span>`).join('')}
                        </div>
                        <div>Vol 24h: ${formatCurrency(opp.volume24h)}</div>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85rem; color: var(--accent-blue);">
                        üí° ${opp.recommendation}
                    </div>
                </div>
            `).join('');
        }

        function renderAllMarkets() {
            const container = document.getElementById('all-markets');
            const categoryFilter = document.getElementById('category-filter').value;
            
            let filtered = allMarkets;
            if (categoryFilter !== 'all') {
                filtered = filtered.filter(m => m.category === categoryFilter);
            }
            
            filtered = filtered.sort((a, b) => b.volume24h - a.volume24h).slice(0, 50);
            
            container.innerHTML = `
                <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 1px solid var(--border);">
                            <th style="padding: 10px;">Market</th>
                            <th style="padding: 10px;">YES</th>
                            <th style="padding: 10px;">NO</th>
                            <th style="padding: 10px;">Volume 24h</th>
                            <th style="padding: 10px;">Liquidity</th>
                            <th style="padding: 10px;">Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filtered.map(m => `
                            <tr style="border-bottom: 1px solid var(--border);">
                                <td style="padding: 10px; max-width: 300px; overflow: hidden; text-overflow: ellipsis;">
                                    <a href="https://polymarket.com/event/${m.slug || m.id}" target="_blank">
                                        ${(m.question || m.title || '').substring(0, 60)}${(m.question || m.title || '').length > 60 ? '...' : ''}
                                    </a>
                                </td>
                                <td style="padding: 10px; color: var(--accent-green);">${(m.yesPrice * 100).toFixed(1)}¬¢</td>
                                <td style="padding: 10px; color: var(--accent-red);">${(m.noPrice * 100).toFixed(1)}¬¢</td>
                                <td style="padding: 10px;">${formatCurrency(m.volume24h)}</td>
                                <td style="padding: 10px;">${formatCurrency(m.liquidity)}</td>
                                <td style="padding: 10px;"><span class="tag">${m.category}</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function updateStats() {
            document.getElementById('total-markets').textContent = allMarkets.length;
            document.getElementById('opportunities-found').textContent = opportunities.length;
            
            const avgEdge = opportunities.length > 0 
                ? (opportunities.reduce((sum, o) => sum + parseFloat(o.expectedEdge), 0) / opportunities.length).toFixed(2)
                : '0';
            document.getElementById('avg-edge').textContent = avgEdge + '%';
            
            const totalVol = allMarkets.reduce((sum, m) => sum + m.volume24h, 0);
            document.getElementById('total-volume').textContent = formatCurrency(totalVol);
        }

        function updateCharts() {
            // Volume Distribution Chart
            const categories = ['politics', 'crypto', 'sports', 'entertainment', 'other'];
            const volumeByCategory = categories.map(cat => 
                allMarkets.filter(m => m.category === cat).reduce((sum, m) => sum + m.volume24h, 0)
            );
            
            if (volumeChart) volumeChart.destroy();
            
            volumeChart = new Chart(document.getElementById('volume-chart'), {
                type: 'doughnut',
                data: {
                    labels: categories.map(c => c.charAt(0).toUpperCase() + c.slice(1)),
                    datasets: [{
                        data: volumeByCategory,
                        backgroundColor: [
                            'rgba(88, 166, 255, 0.8)',
                            'rgba(163, 113, 247, 0.8)',
                            'rgba(63, 185, 80, 0.8)',
                            'rgba(210, 153, 34, 0.8)',
                            'rgba(139, 148, 158, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#f0f6fc' }
                        }
                    }
                }
            });
            
            // Risk/Reward Scatter Chart
            if (scatterChart) scatterChart.destroy();
            
            const scatterData = opportunities.slice(0, 50).map(o => ({
                x: o.liquidity / 1000,
                y: parseFloat(o.expectedEdge),
                label: (o.question || o.title || '').substring(0, 30)
            }));
            
            scatterChart = new Chart(document.getElementById('scatter-chart'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Opportunities',
                        data: scatterData,
                        backgroundColor: 'rgba(88, 166, 255, 0.6)',
                        borderColor: 'rgba(88, 166, 255, 1)',
                        pointRadius: 8,
                        pointHoverRadius: 12
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: { display: true, text: 'Liquidity ($K)', color: '#8b949e' },
                            grid: { color: '#30363d' },
                            ticks: { color: '#8b949e' }
                        },
                        y: {
                            title: { display: true, text: 'Expected Edge (%)', color: '#8b949e' },
                            grid: { color: '#30363d' },
                            ticks: { color: '#8b949e' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const point = scatterData[ctx.dataIndex];
                                    return `${point.label}... | Edge: ${point.y}% | Liq: $${point.x}K`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function getScoreClass(score) {
            if (score >= 50) return 'score-high';
            if (score >= 20) return 'score-medium';
            return 'score-low';
        }

        function formatCurrency(num) {
            if (num >= 1000000) return '$' + (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return '$' + (num / 1000).toFixed(1) + 'K';
            return '$' + num.toFixed(0);
        }

        // Filter change handlers
        document.getElementById('min-liquidity').addEventListener('change', () => {
            analyzeOpportunities();
            renderOpportunities();
            updateStats();
        });
        
        document.getElementById('strategy-filter').addEventListener('change', () => {
            renderOpportunities();
        });
        
        document.getElementById('category-filter').addEventListener('change', () => {
            renderOpportunities();
            renderAllMarkets();
        });
    </script>
</body>
</html>
